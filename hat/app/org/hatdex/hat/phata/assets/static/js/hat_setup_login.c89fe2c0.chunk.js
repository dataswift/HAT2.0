(this["webpackJsonprumpel-react"]=this["webpackJsonprumpel-react"]||[]).push([[10],{234:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));n(0),n(235);var i=n(1),c=function(e){var t=e.type,n=e.children,c=e.fixed,a=e.display;return Object(i.jsx)("div",{children:a&&Object(i.jsx)(i.Fragment,{children:Object(i.jsxs)("div",{className:"notification-banner-container \n            notification-banner-container-".concat(t," \n            ").concat(c?"notification-fixed":null),children:["error"===t&&Object(i.jsx)("i",{className:"material-icons notification-banner-container-icon",children:"warning"}),n]})})})}},235:function(e,t,n){},239:function(e,t,n){"use strict";var i=n(0),c=n(17),a=n(5),r=n(66),o=n(33),s=n(1);t.a=function(e){var t=Object(a.c)();return Object(i.useEffect)((function(){var e=o.parse(window.location.search),n=e.application_id,i=e.name,a=e.redirect_uri,s=e.redirect,d=n||i,l=null===d||void 0===d?void 0:d.toLowerCase();t(a||s?l?Object(c.f)(l):Object(r.g)("application_misconfigured","application_id_is_required "):Object(r.g)("application_misconfigured","redirect_is_required "))}),[t]),Object(s.jsx)(s.Fragment,{children:e.children})}},240:function(e,t,n){"use strict";var i=n(7),c=n(0),a=n(5),r=n(66),o=n(56),s=n(33),d=n(1);t.a=function(e){var t=Object(c.useState)(!1),n=Object(i.a)(t,2),l=n[0],p=n[1],u=Object(a.d)(r.e);Object(c.useEffect)((function(){var e=s.parse(window.location.search),t=e.redirect_uri,n=e.redirect,i=e.fallback,c=e.internal;if(u&&u.error){var a="true"===c,r=function(e,c){var a=t||n;return i||(a?"".concat(a,"?error=").concat(e,"%26error_reason=").concat(c).replace("#","%23"):null)}(u.error,u.errorReason);if(!r)return void p(!0);window.location.href=a&&i||r}}),[u]);var j=function(){return o.a.sandbox?Object(d.jsx)("div",{children:Object(d.jsxs)("div",{className:"app-error",children:[Object(d.jsx)("h3",{className:"app-error-header",children:"Ooops... Looks like something went wrong."}),Object(d.jsxs)("p",{className:"app-error-text",children:['ERROR: App details incorrect. "redirect_uri" query parameter is missing. ',Object(d.jsx)("br",{}),Object(d.jsx)("a",{href:"https://docs.dataswift.io/guides/hat-login/02-send-hat-login",target:"_blank",rel:"noopener noreferrer",children:"Learn more"})]})]})}):Object(d.jsx)("div",{children:Object(d.jsxs)("div",{className:"app-error",children:[Object(d.jsx)("h3",{className:"app-error-header",children:"Ooops... Looks like something went wrong."}),Object(d.jsx)("p",{className:"app-error-text",children:"ERROR: App details incorrect. Please contact the app developer and let them know."})]})})};return Object(d.jsx)(d.Fragment,{children:l?Object(d.jsx)(j,{}):e.children})}},241:function(e,t,n){"use strict";var i=n(0),c=n(5),a=n(17),r=n(66),o=n(34),s=n(60),d=n(33),l=n(1);t.a=function(e){var t=Object(c.d)(r.d),n=Object(c.d)(a.j),p=Object(c.d)(o.f),u=Object(c.d)(s.g),j=Object(c.c)();Object(i.useEffect)((function(){if(n&&n.length>0){var e,t,i=d.parse(window.location.search),c=i.application_id,a=i.name,l=c||a,p=null===l||void 0===l?void 0:l.toLowerCase(),u=n.find((function(e){return e.application.id===p}));if(!u||-1===["App","DataPlug"].indexOf(u.application.kind.kind))return void j(Object(r.g)("application_misconfigured","application_id_not_found "));var f=(null===(e=u.application.dependencies)||void 0===e?void 0:e.plugs)||[],b=(null===(t=u.application.dependencies)||void 0===t?void 0:t.tools)||[];j(Object(o.i)(u)),j(Object(o.g)(n.filter((function(e){return f.indexOf(e.application.id)>-1})))),b.length>0&&j(Object(s.e)())}}),[n,j]),Object(i.useEffect)((function(){if(u&&u.length>0){var e;if(!p)return;var t=(null===(e=p.application.dependencies)||void 0===e?void 0:e.tools)||[];j(Object(o.h)(u.filter((function(e){return-1!==t.indexOf(e.id)}))))}}),[p,u,j]);return t&&0===n.length?Object(l.jsx)("div",{children:Object(l.jsxs)("div",{className:"app-error",children:[Object(l.jsx)("h3",{className:"app-error-header",children:"Looks like something went wrong"}),Object(l.jsx)("p",{className:"app-error-text",children:t}),Object(l.jsx)("button",{className:"btn btn-accent",onClick:function(){j(Object(r.g)("hat_exception","internal_server_error"))},children:"Back"})]})}):Object(l.jsx)(l.Fragment,{children:e.children})}},242:function(e,t,n){"use strict";var i=n(6),c=n(2),a=n.n(c),r=n(0),o=n(5),s=n(10),d=n(34),l=n(33),p=n(259),u=n(131),j=n(262),f=n(1);t.a=function(e){var t=Object(o.d)(d.f),n=Object(o.d)(d.b),c=Object(o.d)(d.c),b=Object(o.d)(d.e);return Object(r.useEffect)((function(){var e=function(){var e=Object(i.a)(a.a.mark((function e(t){var n,i,c,r,o,d,u,j,f,b,h,O,v,m,x,g,w;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.parse(window.location.search),i=n.redirect_uri,c=n.redirect,r=n.internal,o="true"===r,d=i||c,u=decodeURIComponent(d||""),!o){e.next=8;break}window.location.href=d||"",e.next=18;break;case 8:return j=s.a.getInstance(),e.prev=9,e.next=12,j.appLogin(t.application.id);case 12:null!==(b=e.sent)&&void 0!==b&&null!==(f=b.parsedBody)&&void 0!==f&&f.accessToken&&(h=b.parsedBody.accessToken,O=t.application.setup,v=O.validRedirectUris.includes(u),m={applicationId:t.application.id,date:Object(p.a)(new Date,10)},sessionStorage.setItem("attempted_setup",JSON.stringify(m)),x=null===u||void 0===u?void 0:u.includes("www.dataswift.io/sign-up-login"),g=null!==d&&void 0!==d&&d.includes("?")?"&":"?",w=x?window.location.origin+"/feed":"".concat(null===d||void 0===d?void 0:d.replace("#","%23")).concat(g,"token=").concat(h),v?window.location.href=w:(console.warn("Provided URL is not registered"),j.sendReport("hmi_invalid_redirect_url","".concat(t.application.id,": ").concat(d)).then((function(){window.location.href=w})).catch((function(){window.location.href=w})))),e.next=18;break;case 16:e.prev=16,e.t0=e.catch(9);case 18:case"end":return e.stop()}}),e,null,[[9,16]])})));return function(t){return e.apply(this,arguments)}}();if(t&&t.active&&!t.needsUpdating&&c&&b)e(t);else{var n=sessionStorage.getItem("attempted_setup");if(t&&t.enabled&&n){var r=JSON.parse(n);if(r.applicationId===t.application.id&&Object(u.a)(Object(j.a)(r.date)))return void e(t)}}}),[t,n,c,b]),Object(f.jsx)(f.Fragment,{children:e.children})}},243:function(e,t,n){"use strict";var i=n(6),c=n(2),a=n.n(c),r=n(0),o=n(5),s=n(10),d=n(34),l=n(33),p=n(259),u=n(131),j=n(262),f=n(1);t.a=function(e){var t=Object(o.d)(d.f),n=Object(o.d)(d.b),c=Object(o.d)(d.c);return Object(r.useEffect)((function(){var e=l.parse(window.location.search),r=e.application_id,o=e.name,d=e.redirect_uri,f=e.redirect,b=e.dependencies,h=function(){var e=Object(i.a)(a.a.mark((function e(n){var i,c,r,o,d,l;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.filter((function(e){return!e.active}))[0],c=O(i.application.id),e.prev=2,r=s.a.getInstance(),null===i||void 0===i||!i.application.id){e.next=9;break}return e.next=7,r.appLogin(i.application.id);case 7:null!==(d=e.sent)&&void 0!==d&&null!==(o=d.parsedBody)&&void 0!==o&&o.accessToken&&(l={applicationId:null===t||void 0===t?void 0:t.application.id,date:Object(p.a)(new Date,10)},sessionStorage.setItem("attempted_setup",JSON.stringify(l)),window.location.href="".concat(i.application.setup.url,"?token=").concat(d.parsedBody.accessToken,"&redirect=").concat(c));case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(2),console.log("Setup dependencies errored",e.t0);case 14:case"end":return e.stop()}}),e,null,[[2,11]])})));return function(t){return e.apply(this,arguments)}}(),O=function(e){var t=window.location.href.split("?")[0],i=r||o,c=null===i||void 0===i?void 0:i.toLowerCase(),a=d||f,s=b;if(t+="?application_id=".concat(c,"%26redirect_uri=").concat(a),s){var l=s.split(",").filter((function(t){return t!==e}));l&&l.length>0&&(t+="%26dependencies=".concat(l.join()))}else if(n){var p=n.filter((function(t){return t.application.id!==e})).map((function(e){return e.application.id}));p&&p.length>0&&(t+="%26dependencies=".concat(p.join()))}return t.replace("#","%23")},v=sessionStorage.getItem("attempted_setup");if(t&&n&&n.length>0&&v){var m=JSON.parse(v);if(m.applicationId===t.application.id&&Object(u.a)(Object(j.a)(m.date)))return}t&&t.active&&!c&&h(n)}),[t,n,c]),Object(f.jsx)(f.Fragment,{children:e.children})}},244:function(e,t,n){},258:function(e,t,n){},274:function(e,t,n){"use strict";n.r(t);n(0);var i=n(239),c=n(5),a=n(34),r=n(104),o=n(20),s=n(66),d=n(257),l=(n(258),n(13)),p={hatdexRating:"https://docs.dataswift.io/deploy/rating-assurance-and-certification",termsOfService:"https://www.dataswift.io/legal/dataswift-personal-data-account-owner-agreement",privacyPolicy:"https://www.dataswift.io/legal/privacy-policy"},u=n(1),j=function(e){var t=e.app,n=e.onApproved,i=e.onRejected;if(!t.info.updateNotes)return null;var c=function(){return t?Object(u.jsx)("div",{className:"hmi-actions-footer",children:Object(u.jsxs)("div",{className:"sticky-action-panel-content",children:[Object(u.jsxs)("div",{className:"action-buttons",children:[Object(u.jsx)("button",{className:"secondary-action",onClick:function(){return i()},children:Object(u.jsx)(l.a,{id:"hmi.actions.cancel"})}),Object(u.jsx)("button",{className:"primary-action",onClick:function(){return n()},children:Object(u.jsx)(l.a,{id:"hmi.actions.confirm"})})]}),Object(u.jsxs)("p",{className:"tos-text",children:[Object(u.jsx)(l.a,{id:"hmi.actions.agreeWithTermsAndPrivacy.part1"}),Object(u.jsx)("a",{href:p.termsOfService,target:"_blank",rel:"noopener noreferrer",children:Object(u.jsx)(l.a,{id:"hmi.actions.agreeWithTermsAndPrivacy.termsOfService"})}),","," ",Object(u.jsx)("a",{href:p.privacyPolicy,target:"_blank",rel:"noopener noreferrer",children:Object(u.jsx)(l.a,{id:"hmi.actions.agreeWithTermsAndPrivacy.privacyPolicy"})}),Object(u.jsx)(l.a,{id:"hmi.actions.agreeWithTermsAndPrivacy.part2"})]}),Object(u.jsxs)("p",{className:"hmi-id-text",children:["HMI ID: ",t.id,"-",t.info.version]})]})}):null};return Object(u.jsxs)("div",{className:"content-wrapper flex-column-wrapper flex-align-items-center",children:[Object(u.jsxs)("section",{className:"title-section",children:[Object(u.jsx)("div",{className:"app-logo-wrapper",children:Object(u.jsx)("img",{src:t.info.graphics.logo.normal,className:"app-logo",height:"100",width:"100",alt:"".concat(t.info.name," logo")})}),"App"===t.kind.kind&&Object(u.jsx)("div",{className:"app-rating-wrapper",children:Object(u.jsx)("div",{className:"app-rating",children:Object(u.jsxs)("span",{className:"app-rating-highlighted",children:[t.info.rating.score,"\xa0"]})})}),Object(u.jsx)("h3",{className:"title-section-heading",children:t.info.name}),Object(u.jsx)("div",{className:"title-section-text",children:Object(u.jsx)(d.a,{children:t.info.updateNotes.header})})]}),Object(u.jsxs)("section",{className:"update-notes-section",children:[Object(u.jsx)("h4",{className:"section-header",children:"Summary of updates"}),t.info.updateNotes.notes&&Object(u.jsx)("ul",{className:"app-update-notes",children:t.info.updateNotes.notes.map((function(e,t){return Object(u.jsx)("li",{className:"app-update-notes-item",children:Object(u.jsx)("div",{className:"app-update-notes-item-content",children:Object(u.jsx)(d.a,{children:e})})},t)}))})]}),Object(u.jsx)(c,{})]})},f=n(234),b=n(29),h=function(){var e,t,n=window.location.host,i=Object(c.c)(),d=Object(c.d)(b.b),l=Object(c.d)(a.f),p=Object(c.d)(s.d),h=Object(c.d)(a.b),O=Object(c.d)(a.d);return!l||l.active||l.application.dependencies&&(null===(e=l.application.dependencies.plugs)||void 0===e?void 0:e.length)!==h.length||l.application.dependencies&&(null===(t=l.application.dependencies.tools)||void 0===t?void 0:t.length)!==O.length?Object(u.jsx)(r.a,{loadingText:"Loading permissions..."}):Object(u.jsxs)("div",{children:[Object(u.jsx)(f.a,{type:"error",display:!!p,fixed:!0,children:Object(u.jsxs)("div",{className:"hat-login-notification",children:[Object(u.jsxs)("p",{children:["An error has occurred, please use the back button to return to the previous page ",Object(u.jsx)("br",{}),"and try confirming again. If this error persists please"," ",Object(u.jsx)("a",{href:"mailto:contact@dataswift.io",className:"link-button",children:"contact us"})]}),Object(u.jsx)("button",{className:"btn btn-accent",onClick:function(){i(Object(s.g)("hat_exception","enabling_application_failed"))},children:"Back"})]})}),Object(u.jsx)("span",{className:"flex-spacer-small"}),l&&l.needsUpdating&&l.application.info.updateNotes?Object(u.jsx)(j,{app:l.application,onApproved:function(){return i(Object(s.b)((null===l||void 0===l?void 0:l.application.id)||""))},onRejected:function(){return i(Object(s.c)())}}):Object(u.jsx)(o.d,{parentApp:l.application,email:n,language:d,dependencyTools:O.map((function(e){return e.info.name})),dependencyApps:h.map((function(e){return e.application})),onApproved:function(){return i(Object(s.b)((null===l||void 0===l?void 0:l.application.id)||""))},onRejected:function(){return i(Object(s.c)())}})]})},O=n(240),v=n(241),m=n(242),x=n(243);n(244),t.default=function(){return Object(u.jsx)(i.a,{children:Object(u.jsx)(v.a,{children:Object(u.jsx)(m.a,{children:Object(u.jsx)(x.a,{children:Object(u.jsx)(O.a,{children:Object(u.jsx)(h,{})})})})})})}}}]);
//# sourceMappingURL=hat_setup_login.c89fe2c0.chunk.js.map